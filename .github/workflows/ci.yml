  # Java Package CI
  java-ci:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        java-version: [8, 11, 17]
    
    defaults:
      run:
        working-directory: ./java
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Set up JDK ${{ matrix.java-version }}
      uses: actions/setup-java@v3
      with:
        java-version: ${{ matrix.java-version }}
        distribution: 'temurin'
    
    - name: Cache Maven dependencies
      uses: actions/cache@v3
      with:
        path: ~/.m2
        key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}
        restore-keys: ${{ runner.os }}-m2
    
    - name: Build with Maven
      run: mvn clean compile -DskipTests
    
    - name: Run tests
      run: mvn test
    
    - name: Package JAR
      run: mvn package -DskipTests
    
    - name: Verify package
      run: |
        if [ -f "target/minecraft-server-utility-1.0.0.jar" ]; then
          echo "âœ… JAR file created successfully"
          ls -la target/*.jar
        else
          echo "âŒ JAR file not found"
          ls -la target/
        fi
    
    - name: Upload Java artifacts
      uses: actions/upload-artifact@v3
      with:
        name: java-package-jdk-${{ matrix.java-version }}
        path: ./java/target/*.jar
    
    # Only deploy on main branch and release events
    - name: Deploy to GitHub Packages
      if: github.ref == 'refs/heads/main' && matrix.java-version == 11
      run: |
        # Create minimal pom.xml for deployment
        cat > pom-deploy.xml << 'EOF'
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
         http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <groupId>com.minecraftutility</groupId>
    <artifactId>minecraft-server-utility</artifactId>
    <version>1.0.0</version>
    <packaging>jar</packaging>
</project>
EOF
        
        echo "ðŸ“¦ Skipping GitHub Packages deployment for now"
        # mvn deploy:deploy-file \
        #   -Dfile=target/minecraft-server-utility-1.0.0.jar \
        #   -DpomFile=pom-deploy.xml \
        #   -DrepositoryId=github \
        #   -Durl=https://maven.pkg.github.com/${{ github.repository }} \
        #   -Dtoken=${{ secrets.GITHUB_TOKEN }}
